<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberSpy - Educational Security Tool</title>
    <link rel="stylesheet" href="cyber.css">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>
    <canvas class="matrix-bg" id="matrixCanvas"></canvas>

    <!-- User Guide Popup -->
    <div class="guide-overlay" id="guideOverlay">
        <div class="guide-container">
            <div class="guide-header">
                <div class="guide-title">üõ°Ô∏è CYBERSPY U-GUIDE</div>
                <div class="guide-subtitle">OPERATIONAL MANUAL v1.1.0</div>
                <button class="guide-close" onclick="closeGuide()">[X]</button>
            </div>
            <div class="guide-content" id="guideContent">
                <div class="guide-loading">
                    <div class="loading-text">Initializing secure connection...</div>
                    <div class="loading-bar">
                        <div class="loading-progress" id="loadingProgress"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <div class="title">üïµÔ∏è CYBERSPY</div>
            <div class="subtitle">Educational Security Monitoring System</div><br>
            <div class="status-bar">
                <div class="status-item">
                    <span>Status:</span>
                    <span style="color: #00ff41;">ONLINE</span>
                    <span class="blink">‚óè</span>
                </div>
                <div class="status-item">
                    <span>Mode:</span>
                    <span style="color: #00ccff;">MESSAGING</span>
                </div>
                <div class="status-item">
                    <span>Time:</span>
                    <span id="currentTime"></span>
                </div>
            </div>
        </div>

        <div class="crypto-panel">
            <div class="panel-header">
                <div class="panel-icon">üîê</div>
                <div class="panel-title">Advanced Cryptography Lab</div>
            </div>
            <div class="crypto-tools">
                <div class="crypto-section">
                    <h3 style="color: #00ccff; margin-bottom: 15px;">üî§ Caesar Cipher</h3>
                    <div class="input-group">
                        <label>Message:</label>
                        <textarea id="caesarInput" placeholder="Enter your message..."></textarea>
                    </div>
                    <div class="input-group">
                        <label>Shift (1-25):</label>
                        <input type="number" id="caesarShift" min="1" max="25" value="3">
                    </div>
                    <button class="crypto-btn" onclick="caesarEncrypt()">Encrypt</button>
                    <button class="crypto-btn" onclick="caesarDecrypt()">Decrypt</button>
                    <button class="crypto-btn" onclick="caesarBruteForce()">Brute Force</button>
                    <div class="crypto-output" id="caesarOutput">Results will appear here...</div>
                </div>

                <div class="crypto-section">
                    <h3 style="color: #00ccff; margin-bottom: 15px;">üìú Vigen√®re Cipher</h3>
                    <div class="input-group">
                        <label>Message:</label>
                        <textarea id="vigenereInput" placeholder="Enter your message..."></textarea>
                    </div>
                    <div class="input-group">
                        <label>Key:</label>
                        <input type="text" id="vigenereKey" placeholder="Enter key...">
                    </div>
                    <button class="crypto-btn" onclick="vigenereEncrypt()">Encrypt</button>
                    <button class="crypto-btn" onclick="vigenereDecrypt()">Decrypt</button>
                    <button class="crypto-btn" onclick="vigenereAnalyze()">Key Analysis</button>
                    <div class="crypto-output" id="vigenereOutput">Results will appear here...</div>
                </div>

                <div class="crypto-section">
                    <h3 style="color: #00ccff; margin-bottom: 15px;">üïµÔ∏è Frequency Analysis</h3>
                    <div class="input-group">
                        <label>Cipher Text:</label>
                        <textarea id="frequencyInput" placeholder="Enter cipher text for analysis..."></textarea>
                    </div>
                    <button class="crypto-btn" onclick="performFrequencyAnalysis()">Analyze</button>
                    <div class="frequency-analysis" id="frequencyChart"></div>
                    <div class="crypto-output" id="frequencyOutput">Frequency analysis results...</div>
                </div>

                <!-- <div class="crypto-section">
                    <h3 style="color: #00ccff; margin-bottom: 15px;">‚ö° Hybrid Cipher Breaker</h3>
                    <div class="input-group">
                        <label>Encrypted Message:</label>
                        <textarea id="hybridInput" placeholder="Enter encrypted text to crack..."></textarea>
                    </div>
                    <button class="crypto-btn" onclick="hybridCrack()">Auto-Crack</button>
                    <div class="crypto-output brute-force-results" id="hybridOutput">Crack attempts will appear here...</div>
                </div> -->
            </div>
        </div>

        <div class="dashboard">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-icon">üåê</div>
                    <div class="panel-title">Network Monitor</div>
                </div>
                <div class="metric">
                    <span>Active Connections:</span>
                    <span id="connections">42</span>
                </div>
                <div class="metric">
                    <span>Packets/sec:</span>
                    <span id="packets">1,247</span>
                </div>
                <div class="metric">
                    <span>Bandwidth:</span>
                    <span id="bandwidth">89.3 MB/s</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="networkProgress"></div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-icon">üîí</div>
                    <div class="panel-title">Security Status</div>
                </div>
                <div class="metric">
                    <span>Threat Level:</span>
                    <span style="color: #00ff41;">LOW</span>
                </div>
                <div class="metric">
                    <span>Firewall:</span>
                    <span style="color: #00ff41;">ACTIVE</span>
                </div>
                <div class="metric">
                    <span>Last Scan:</span>
                    <span id="lastScan">2 min ago</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="securityProgress"></div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-icon">üíª</div>
                    <div class="panel-title">System Resources</div>
                </div>
                <div class="metric">
                    <span>CPU Usage:</span>
                    <span id="cpu">34%</span>
                </div>
                <div class="metric">
                    <span>Memory:</span>
                    <span id="memory">67%</span>
                </div>
                <div class="metric">
                    <span>Disk I/O:</span>
                    <span id="diskio">Low</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="systemProgress"></div>
                </div>
            </div>

            <!-- <div class="panel">
                <div class="panel-header">
                    <div class="panel-icon">üéØ</div>
                    <div class="panel-title">Mission Status</div>
                </div>
                <div class="metric">
                    <span>Objective:</span>
                    <span style="color: #00ccff;">LEARNING</span>
                </div>
                <div class="metric">
                    <span>Progress:</span>
                    <span id="missionProgress">78%</span>
                </div>
                <div class="metric">
                    <span>Skills Unlocked:</span>
                    <span id="skillsUnlocked">12/20</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="missionProgressBar"></div>
                </div>
            </div> -->
        </div>

        <div class="terminal">
            <div class="terminal-header">
                <div class="terminal-title">CyberSpy Terminal v1.1.0</div>
                <div class="terminal-controls">
                    <div class="control-btn"></div>
                    <div class="control-btn"></div>
                    <div class="control-btn"></div>
                </div>
            </div>
            <div class="terminal-output" id="terminalOutput">
                <div class="terminal-line">Welcome to CyberSpy Educational Terminal</div>
                <div class="terminal-line">Type 'help' for available commands</div>
                <div class="terminal-line">System initialized... <span class="blink">‚ñà</span></div>
            </div>
            <div class="terminal-input">
                <span class="prompt">cyberspy@education:~$</span>
                <input type="text" class="input-field" id="commandInput" placeholder="Enter command..." autocomplete="off">
            </div>
        </div>
    </div>


    <script>
        // Audio context for typing sounds
        let audioContext;
        let isTyping = false;

        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        function playTypingSound() {
            if (!audioContext) return;
            
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const noiseBuffer = createNoiseBuffer();
            const noiseSource = audioContext.createBufferSource();
            
            const gainNode = audioContext.createGain();
            const filterNode = audioContext.createBiquadFilter();
            
            noiseSource.buffer = noiseBuffer;
            
            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            noiseSource.connect(filterNode);
            filterNode.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            filterNode.type = 'highpass';
            filterNode.frequency.setValueAtTime(2000, audioContext.currentTime);
            filterNode.Q.setValueAtTime(1, audioContext.currentTime);
            
            const baseFreq = 800 + Math.random() * 200;
            oscillator1.frequency.setValueAtTime(baseFreq, audioContext.currentTime);
            oscillator1.frequency.exponentialRampToValueAtTime(baseFreq * 0.3, audioContext.currentTime + 0.05);
            oscillator1.type = 'triangle';
            
            oscillator2.frequency.setValueAtTime(baseFreq * 2.5, audioContext.currentTime);
            oscillator2.frequency.exponentialRampToValueAtTime(baseFreq * 0.8, audioContext.currentTime + 0.02);
            oscillator2.type = 'sawtooth';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 0.005);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.03);
            gainNode.gain.linearRampToValueAtTime(0.001, audioContext.currentTime + 0.08);
            
            const startTime = audioContext.currentTime;
            const endTime = startTime + 0.08;
            
            oscillator1.start(startTime);
            oscillator1.stop(endTime);
            
            oscillator2.start(startTime);
            oscillator2.stop(startTime + 0.02);
            
            noiseSource.start(startTime);
            noiseSource.stop(startTime + 0.01);
        }

        function createNoiseBuffer() {
            const bufferSize = audioContext.sampleRate * 0.01;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                output[i] = (Math.random() * 2 - 1) * 0.1;
            }
            
            return buffer;
        }

        // User Guide System
        const userGuideContent = `
<div class="guide-section">
    <div class="guide-section-title">üîê CAESAR CIPHER MODULE</div>
    <div class="guide-feature">
        <div class="guide-feature-title">Basic Operations</div>
        <div class="guide-feature-desc">The Caesar cipher shifts each letter by a fixed number of positions in the alphabet.</div>
        <ul class="guide-steps">
            <li>Enter your message in the text area</li>
            <li>Set shift value (1-25) - default is 3</li>
            <li>Click 'Encrypt' to encode or 'Decrypt' to decode</li>
            <li>Use 'Brute Force' to try all possible shifts</li>
        </ul>
        <div class="guide-tip">üí° TIP: Common Caesar shift values are 3, 13 (ROT13), and 21.</div>
    </div>
</div>

<div class="guide-section">
    <div class="guide-section-title">üìú VIGEN√àRE CIPHER MODULE</div>
    <div class="guide-feature">
        <div class="guide-feature-title">Advanced Polyalphabetic Encryption</div>
        <div class="guide-feature-desc">Uses a keyword to create multiple Caesar ciphers, making it much stronger than simple substitution.</div>
        <ul class="guide-steps">
            <li>Enter your message in the text area</li>
            <li>Provide a keyword (letters only, no spaces)</li>
            <li>Choose 'Encrypt' or 'Decrypt' operation</li>
            <li>Use 'Key Analysis' to detect possible key lengths</li>
        </ul>
        <div class="guide-tip">üí° TIP: Longer keys provide better security. Avoid dictionary words.</div>
        <div class="guide-warning">‚ö†Ô∏è WARNING: Key analysis works best with texts longer than 100 characters.</div>
    </div>
</div>

<div class="guide-section">
    <div class="guide-section-title">üïµÔ∏è FREQUENCY ANALYSIS MODULE</div>
    <div class="guide-feature">
        <div class="guide-feature-title">Cryptanalysis Tool</div>
        <div class="guide-feature-desc">Analyzes letter frequency patterns to break substitution ciphers.</div>
        <ul class="guide-steps">
            <li>Paste encrypted text into the analysis area</li>
            <li>Click 'Analyze' to generate frequency chart</li>
            <li>Compare results with English letter frequencies</li>
            <li>Most common English letters: E(12.7%), T(9.1%), A(8.2%)</li>
        </ul>
        <div class="guide-tip">üí° TIP: Works best with longer cipher texts (200+ characters).</div>
    </div>
</div>

<div class="guide-section">
    <div class="guide-section-title">üñ•Ô∏è TERMINAL INTERFACE</div>
    <div class="guide-feature">
        <div class="guide-feature-title">Command Line Operations</div>
        <div class="guide-feature-desc">Access advanced cryptographic functions through terminal commands.</div>
        <ul class="guide-steps">
            <li>Type 'help' to see all available commands</li>
            <li>Use 'caesar encrypt/decrypt/crack [text] [shift]'</li>
            <li>Use 'vigenere encrypt/decrypt [text] [key]'</li>
            <li>Use 'frequency [text]' for quick analysis</li>
            <li>Use 'crack [ciphertext]' for auto-decryption</li>
        </ul>
        <div class="guide-tip">üí° TIP: Terminal provides faster access to crypto functions.</div>
    </div>
</div>

<div class="guide-section">
    <div class="guide-section-title">üìä MONITORING DASHBOARD</div>
    <div class="guide-feature">
        <div class="guide-feature-title">System Status Overview</div>
        <div class="guide-feature-desc">Real-time monitoring of network, security, and system resources.</div>
        <ul class="guide-steps">
            <li>Network Monitor: Shows active connections and traffic</li>
            <li>Security Status: Displays firewall and threat levels</li>
            <li>System Resources: Monitors CPU, memory, and disk usage</li>
            <li>All metrics update automatically every 3 seconds</li>
        </ul>
    </div>
</div>

<div class="guide-section">
    <div class="guide-section-title">üöÄ GETTING STARTED</div>
    <div class="guide-feature">
        <div class="guide-feature-title">Quick Start Guide</div>
        <div class="guide-feature-desc">Begin your cybersecurity journey with these recommended steps:</div>
        <ul class="guide-steps">
            <li>Start with Caesar cipher - encrypt "HELLO WORLD" with shift 5</li>
            <li>Try decrypting "MJQQT BTWQI" using brute force</li>
            <li>Experiment with Vigen√®re using key "SECRET"</li>
            <li>Analyze frequency of "WKLV LV D WHVW PHVVDJH"</li>
            <li>Explore terminal commands with 'mission' command</li>
        </ul>
        <div class="guide-tip">üí° TIP: Practice with short messages first, then try longer texts!</div>
    </div>
</div>
        `;

        function showUserGuide() {
            const overlay = document.getElementById('guideOverlay');
            const content = document.getElementById('guideContent');
            
            overlay.style.display = 'flex';
            
            setTimeout(() => {
                const loadingProgress = document.getElementById('loadingProgress');
                if (loadingProgress) {
                    loadingProgress.style.width = '100%';
                }
            }, 100);
            
            setTimeout(() => {
                content.innerHTML = '<div class="blinking-cursor"></div>';
                typewriterEffectHTML(content, userGuideContent);
            }, 3000);
        }

        function closeGuide() {
            document.getElementById('guideOverlay').style.display = 'none';
        }

        function typewriterEffectHTML(element, text) {
            if (!audioContext) initAudio();
            
            element.innerHTML = '';
            let i = 0;
            
            function typeChar() {
                if (i < text.length) {
                    element.innerHTML = text.substring(0, i + 1) + '<span class="blinking-cursor"></span>';
                    if (Math.random() > 0.7) playTypingSound();
                    i++;
                    const delay = text.charAt(i-1) === ' ' ? 15 : 8 + Math.random() * 10;
                    setTimeout(typeChar, delay);
                } else {
                    element.innerHTML = text;
                }
            }
            
            typeChar();
        }

        function typewriterEffect(element, text, callback = null) {
            if (!audioContext) initAudio();
            
            element.textContent = '';
            isTyping = true;
            let i = 0;
            
            function typeChar() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    playTypingSound();
                    i++;
                    const baseDelay = 30;
                    const variation = Math.random() * 40;
                    const isSpace = text.charAt(i-1) === ' ';
                    const delay = isSpace ? baseDelay + 20 : baseDelay + variation;
                    setTimeout(typeChar, delay);
                } else {
                    isTyping = false;
                    if (callback) callback();
                }
            }
            
            typeChar();
        }

        function addToTerminalWithEffect(text, callback = null) {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            terminalOutput.appendChild(line);
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
            
            typewriterEffect(line, text, callback);
        }

        // Show guide on page load
        window.addEventListener('load', () => {
            setTimeout(showUserGuide, 1000);
        });

        // Close guide with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeGuide();
            }
        });

        // Cryptography Functions
        function caesarShift(text, shift, decrypt = false) {
            if (decrypt) shift = -shift;
            return text.replace(/[A-Za-z]/g, function(char) {
                const start = char <= 'Z' ? 65 : 97;
                return String.fromCharCode((char.charCodeAt(0) - start + shift + 26) % 26 + start);
            });
        }

        function vigenereShift(text, key, decrypt = false) {
            key = key.toUpperCase().replace(/[^A-Z]/g, '');
            if (!key) return text;
            
            let result = '';
            let keyIndex = 0;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (/[A-Za-z]/.test(char)) {
                    const start = char <= 'Z' ? 65 : 97;
                    const shift = key.charCodeAt(keyIndex % key.length) - 65;
                    const actualShift = decrypt ? -shift : shift;
                    result += String.fromCharCode((char.charCodeAt(0) - start + actualShift + 26) % 26 + start);
                    keyIndex++;
                } else {
                    result += char;
                }
            }
            return result;
        }

        function getFrequencyAnalysis(text) {
            const freq = {};
            const letters = text.replace(/[^A-Za-z]/g, '').toUpperCase();
            
            for (let char of letters) {
                freq[char] = (freq[char] || 0) + 1;
            }
            
            return freq;
        }

        function caesarEncrypt() {
            const input = document.getElementById('caesarInput').value;
            const shift = parseInt(document.getElementById('caesarShift').value) || 3;
            const result = caesarShift(input, shift);
            
            typewriterEffect(document.getElementById('caesarOutput'), 
                `Encrypted: ${result}\nShift: ${shift}`);
        }

        function caesarDecrypt() {
            const input = document.getElementById('caesarInput').value;
            const shift = parseInt(document.getElementById('caesarShift').value) || 3;
            const result = caesarShift(input, shift, true);
            
            typewriterEffect(document.getElementById('caesarOutput'), 
                `Decrypted: ${result}\nShift: ${shift}`);
        }

        function caesarBruteForce() {
            const input = document.getElementById('caesarInput').value;
            const output = document.getElementById('caesarOutput');
            
            let results = "BRUTE FORCE ATTACK - ALL POSSIBLE SHIFTS:\n";
            results += "=" .repeat(40) + "\n";
            
            for (let i = 1; i <= 25; i++) {
                const decrypted = caesarShift(input, i, true);
                results += `Shift ${i.toString().padStart(2)}: ${decrypted}\n`;
            }
            
            typewriterEffect(output, results);
        }

        function vigenereEncrypt() {
            const input = document.getElementById('vigenereInput').value;
            const key = document.getElementById('vigenereKey').value;
            if (!key) {
                typewriterEffect(document.getElementById('vigenereOutput'), 'Error: Please enter a key');
                return;
            }
            
            const result = vigenereShift(input, key);
            typewriterEffect(document.getElementById('vigenereOutput'), 
                `Encrypted: ${result}\nKey: ${key.toUpperCase()}`);
        }

        function vigenereDecrypt() {
            const input = document.getElementById('vigenereInput').value;
            const key = document.getElementById('vigenereKey').value;
            if (!key) {
                typewriterEffect(document.getElementById('vigenereOutput'), 'Error: Please enter a key');
                return;
            }
            
            const result = vigenereShift(input, key, true);
            typewriterEffect(document.getElementById('vigenereOutput'), 
                `Decrypted: ${result}\nKey: ${key.toUpperCase()}`);
        }

        function vigenereAnalyze() {
            const input = document.getElementById('vigenereInput').value;
            const output = document.getElementById('vigenereOutput');
            
            let analysis = "VIGEN√àRE CIPHER ANALYSIS\n";
            analysis += "=" .repeat(30) + "\n";
            analysis += "Attempting key length detection...\n\n";
            
            const cleanText = input.replace(/[^A-Za-z]/g, '').toUpperCase();
            
            for (let keyLen = 2; keyLen <= 10; keyLen++) {
                let ic = 0;
                for (let i = 0; i < keyLen; i++) {
                    let substring = '';
                    for (let j = i; j < cleanText.length; j += keyLen) {
                        substring += cleanText[j];
                    }
                    const freq = getFrequencyAnalysis(substring);
                    const n = substring.length;
                    if (n > 1) {
                        let sum = 0;
                        for (let char in freq) {
                            sum += freq[char] * (freq[char] - 1);
                        }
                        ic += sum / (n * (n - 1));
                    }
                }
                ic /= keyLen;
                analysis += `Key length ${keyLen}: IC = ${ic.toFixed(4)} ${ic > 0.06 ? '(Possible!)' : ''}\n`;
            }
            
            typewriterEffect(output, analysis);
        }

        function performFrequencyAnalysis() {
            const input = document.getElementById('frequencyInput').value;
            const freq = getFrequencyAnalysis(input);
            const chart = document.getElementById('frequencyChart');
            const output = document.getElementById('frequencyOutput');
            
            chart.innerHTML = '';
            const maxFreq = Math.max(...Object.values(freq));
            
            for (let i = 0; i < 26; i++) {
                const char = String.fromCharCode(65 + i);
                const count = freq[char] || 0;
                const percentage = maxFreq > 0 ? (count / maxFreq) * 100 : 0;
                
                const bar = document.createElement('div');
                bar.className = 'freq-bar';
                bar.innerHTML = `<div class="freq-letter">${char}</div><div class="freq-count" style="height: ${percentage}%"></div><div style="font-size: 8px;">${count}</div>`;
                chart.appendChild(bar);
            }
            
            const total = Object.values(freq).reduce((a, b) => a + b, 0);
            let analysis = "FREQUENCY ANALYSIS RESULTS\n";
            analysis += "=" .repeat(30) + "\n";
            analysis += `Total letters analyzed: ${total}\n\n`;
            analysis += "Most frequent letters:\n";
            
            const sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]);
            sorted.slice(0, 5).forEach(([char, count]) => {
                const percent = ((count / total) * 100).toFixed(1);
                analysis += `${char}: ${count} (${percent}%)\n`;
            });
            
            analysis += "\nEnglish frequency: E(12.7%) T(9.1%) A(8.2%) O(7.5%) I(7.0%)";
            
            typewriterEffect(output, analysis);
        }

        function calculateEnglishness(text) {
            const commonWords = ['THE', 'AND', 'FOR', 'ARE', 'BUT', 'NOT', 'YOU', 'ALL', 'CAN', 'HER', 'WAS', 'ONE', 'OUR', 'HAD', 'DAY', 'GET', 'USE', 'MAN', 'NEW', 'NOW', 'WAY', 'SAY', 'EACH', 'WHICH', 'THEIR'];
            const words = text.toUpperCase().replace(/[^A-Z\s]/g, '').split(/\s+/);
            const matches = words.filter(word => commonWords.includes(word)).length;
            return matches / Math.max(words.length, 1);
        }

        // Matrix Background Effect
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const matrix = "ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%+-/~{[|`]}";
        const matrixArray = matrix.split("");

        const fontSize = 10;
        const columns = canvas.width / fontSize;

        const drops = [];
        for(let x = 0; x < columns; x++) {
            drops[x] = 1;
        }

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#00ff41';
            ctx.font = fontSize + 'px arial';

            for(let i = 0; i < drops.length; i++) {
                const text = matrixArray[Math.floor(Math.random() * matrixArray.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        setInterval(drawMatrix, 35);

        // Terminal functionality
        const terminalOutput = document.getElementById('terminalOutput');
        const commandInput = document.getElementById('commandInput');

        const commands = {
            help: {
                description: "Show available commands",
                execute: () => {
                    return [
                        "Available Commands:",
                        "==================",
                        "help         - Show this help menu",
                        "scan         - Perform network scan",
                        "status       - Show system status",
                        "nmap         - Simulate network mapping",
                        "whoami       - Display current user",
                        "ls           - List directory contents",
                        "pwd          - Show current directory",
                        "ping         - Ping a target (educational)",
                        "encrypt      - Encrypt a message",
                        "decrypt      - Decrypt a message",
                        "caesar       - Caesar cipher tools",
                        "vigenere     - Vigen√®re cipher tools", 
                        "frequency    - Frequency analysis",
                        "crack        - Auto-crack cipher",
                        "clear        - Clear terminal",
                        "matrix       - Toggle matrix effect",
                        "mission      - Show mission briefing"
                    ];
                }
            },
            scan: {
                description: "Perform network scan",
                execute: () => {
                    const results = [
                        "Initiating network scan...",
                        "Scanning ports 1-1000...",
                        "Port 22/tcp  open  ssh",
                        "Port 80/tcp  open  http",
                        "Port 443/tcp open  https",
                        "Port 3306/tcp closed mysql",
                        "Scan completed. 3 open ports found."
                    ];
                    return results;
                }
            },
            nmap: {
                description: "Simulate network mapping",
                execute: (args) => {
                    const target = args[0] || "127.0.0.1";
                    return [
                        `Starting Nmap scan on ${target}...`,
                        "Host is up (0.00050s latency).",
                        "PORT     STATE SERVICE",
                        "22/tcp   open  ssh",
                        "80/tcp   open  http",
                        "443/tcp  open  https",
                        "MAC Address: 00:14:22:01:23:45 (Dell Inc.)",
                        "Nmap scan completed."
                    ];
                }
            },
            whoami: {
                description: "Display current user",
                execute: () => ["cyberspy-agent"]
            },
            pwd: {
                description: "Show current directory",
                execute: () => ["/home/cyberspy/mission"]
            },
            ls: {
                description: "List directory contents",
                execute: () => [
                    "mission_briefing.txt",
                    "tools/",
                    "logs/",
                    "encrypted_files/",
                    "network_data.pcap"
                ]
            },
            ping: {
                description: "Ping a target",
                execute: (args) => {
                    const target = args[0] || "google.com";
                    return [
                        `PING ${target} (8.8.8.8): 56 data bytes`,
                        "64 bytes from 8.8.8.8: icmp_seq=0 ttl=117 time=12.1 ms",
                        "64 bytes from 8.8.8.8: icmp_seq=1 ttl=117 time=11.9 ms",
                        "64 bytes from 8.8.8.8: icmp_seq=2 ttl=117 time=12.3 ms",
                        "--- ping statistics ---",
                        "3 packets transmitted, 3 received, 0% packet loss"
                    ];
                }
            },
            status: {
                description: "Show system status",
                execute: () => [
                    "System Status Report:",
                    "=====================",
                    "Firewall: ACTIVE",
                    "Antivirus: UP TO DATE",
                    "Network: SECURE",
                    "Encryption: AES-256",
                    "Mission Status: 78% COMPLETE",
                    "Agent Level: INTERMEDIATE"
                ]
            },
            encrypt: {
                description: "Encrypt a message",
                execute: (args) => {
                    const message = args.join(' ') || "Hello World";
                    const encrypted = btoa(message);
                    return [
                        `Original: ${message}`,
                        `Encrypted (Base64): ${encrypted}`,
                        "Encryption complete."
                    ];
                }
            },
            decrypt: {
                description: "Decrypt a message",
                execute: (args) => {
                    const encrypted = args[0] || "SGVsbG8gV29ybGQ=";
                    try {
                        const decrypted = atob(encrypted);
                        return [
                            `Encrypted: ${encrypted}`,
                            `Decrypted: ${decrypted}`,
                            "Decryption complete."
                        ];
                    } catch (e) {
                        return ["Error: Invalid encrypted message"];
                    }
                }
            },
            clear: {
                description: "Clear terminal",
                execute: () => {
                    terminalOutput.innerHTML = '<div class="terminal-line">Terminal cleared.</div>';
                    return [];
                }
            },
            matrix: {
                description: "Toggle matrix effect",
                execute: () => {
                    const canvas = document.getElementById('matrixCanvas');
                    canvas.style.opacity = canvas.style.opacity === '0' ? '0.1' : '0';
                    return ["Matrix effect toggled."];
                }
            },
            mission: {
                description: "Show mission briefing",
                execute: () => [
                    "MISSION BRIEFING - CLASSIFICATION: EDUCATIONAL",
                    "==============================================",
                    "Objective: Learn cybersecurity fundamentals",
                    "Skills to master:",
                    "‚Ä¢ Network scanning and reconnaissance",
                    "‚Ä¢ Encryption and decryption techniques",
                    "‚Ä¢ System monitoring and analysis",
                    "‚Ä¢ Security best practices",
                    "‚Ä¢ Advanced cryptanalysis",
                    "‚Ä¢ Cipher breaking techniques",
                    "",
                    "New Skills Unlocked:",
                    "‚Ä¢ Caesar cipher cryptanalysis",
                    "‚Ä¢ Vigen√®re cipher breaking",
                    "‚Ä¢ Frequency analysis",
                    "‚Ä¢ Hybrid cipher cracking",
                    "",
                    "Remember: Always use these skills ethically!",
                    "Good luck, Agent!"
                ]
            },
            caesar: {
                description: "Caesar cipher educational tool",
                execute: (args) => {
                    if (args.length < 2) {
                        return ["Usage: caesar <encrypt/decrypt/crack> <text> [shift]"];
                    }
                    const action = args[0];
                    const text = args.slice(1, -1).join(' ') || args[1];
                    const shift = parseInt(args[args.length - 1]) || 3;
                    
                    if (action === 'encrypt') {
                        return [`Caesar Encrypted: ${caesarShift(text, shift)}`];
                    } else if (action === 'decrypt') {
                        return [`Caesar Decrypted: ${caesarShift(text, shift, true)}`];
                    } else if (action === 'crack') {
                        const results = [];
                        for (let i = 1; i <= 25; i++) {
                            results.push(`Shift ${i}: ${caesarShift(text, i, true)}`);
                        }
                        return results;
                    }
                    return ["Invalid action. Use: encrypt, decrypt, or crack"];
                }
            },
            vigenere: {
                description: "Vigen√®re cipher educational tool",
                execute: (args) => {
                    if (args.length < 3) {
                        return ["Usage: vigenere <encrypt/decrypt> <text> <key>"];
                    }
                    const action = args[0];
                    const key = args[args.length - 1];
                    const text = args.slice(1, -1).join(' ');
                    
                    if (action === 'encrypt') {
                        return [`Vigen√®re Encrypted: ${vigenereShift(text, key)}`];
                    } else if (action === 'decrypt') {
                        return [`Vigen√®re Decrypted: ${vigenereShift(text, key, true)}`];
                    }
                    return ["Invalid action. Use: encrypt or decrypt"];
                }
            },
            frequency: {
                description: "Perform frequency analysis",
                execute: (args) => {
                    const text = args.join(' ');
                    if (!text) return ["Usage: frequency <text to analyze>"];
                    
                    const freq = getFrequencyAnalysis(text);
                    const sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]);
                    const results = ["Frequency Analysis:", "=================="];
                    sorted.slice(0, 10).forEach(([char, count]) => {
                        results.push(`${char}: ${count} occurrences`);
                    });
                    return results;
                }
            },
            crack: {
                description: "Auto-crack unknown cipher",
                execute: (args) => {
                    const text = args.join(' ');
                    if (!text) return ["Usage: crack <encrypted text>"];
                    
                    const results = ["Auto-cracking cipher...", "======================"];
                    
                    for (let i = 1; i <= 25; i++) {
                        const attempt = caesarShift(text, i, true);
                        if (calculateEnglishness(attempt) > 0.3) {
                            results.push(`Possible Caesar (shift ${i}): ${attempt}`);
                        }
                    }
                    
                    const keys = ['KEY', 'SECRET', 'CIPHER', 'CODE'];
                    keys.forEach(key => {
                        const attempt = vigenereShift(text, key, true);
                        if (calculateEnglishness(attempt) > 0.2) {
                            results.push(`Possible Vigen√®re (key ${key}): ${attempt}`);
                        }
                    });
                    
                    if (results.length === 2) {
                        results.push("No clear matches found. Manual analysis recommended.");
                    }
                    
                    return results;
                }
            }
        };

        function addToTerminal(text) {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.textContent = text;
            terminalOutput.appendChild(line);
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        commandInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const input = commandInput.value.trim();
                if (input) {
                    addToTerminal(`cyberspy@education:~$ ${input}`);
                    
                    const args = input.split(' ');
                    const command = args[0].toLowerCase();
                    const commandArgs = args.slice(1);

                    if (commands[command]) {
                        const output = commands[command].execute(commandArgs);
                        if (Array.isArray(output)) {
                            let i = 0;
                            function showNextLine() {
                                if (i < output.length) {
                                    addToTerminalWithEffect(output[i], () => {
                                        i++;
                                        setTimeout(showNextLine, 100);
                                    });
                                }
                            }
                            showNextLine();
                        }
                    } else {
                        addToTerminalWithEffect(`Command not found: ${command}. Type 'help' for available commands.`);
                    }
                }
                commandInput.value = '';
            }
        });

        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('en-US', { hour12: false });
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Simulate dynamic data updates
        function updateMetrics() {
            document.getElementById('connections').textContent = Math.floor(Math.random() * 100) + 20;
            document.getElementById('packets').textContent = (Math.floor(Math.random() * 2000) + 500).toLocaleString();
            document.getElementById('bandwidth').textContent = (Math.random() * 100).toFixed(1) + ' MB/s';
            document.getElementById('cpu').textContent = Math.floor(Math.random() * 60) + 20 + '%';
            
            document.getElementById('networkProgress').style.width = (Math.random() * 100) + '%';
            document.getElementById('securityProgress').style.width = '85%';
            document.getElementById('systemProgress').style.width = (Math.random() * 100) + '%';
        }

        setInterval(updateMetrics, 3000);
        updateMetrics();

        // Resize canvas on window resize
        window.addEventListener('resize', function() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Focus on terminal input
        commandInput.focus();
    </script>
</body>
</html>